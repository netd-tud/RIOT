From aa6a01b5cd53ca5fc9c9c59aae3a52d6e837d590 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Mikolai=20G=C3=BCtschow?= <mikolai.guetschow@tu-dresden.de>
Date: Fri, 1 Nov 2024 13:21:27 +0100
Subject: [PATCH 1/3] cc3xx/low_level/init: skip explicit disabling of DFA
 countermeasures for CC310 since AO interface seems not to be available for
 that hardware version
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Change-Id: Ida5610a059a0dce242ad6e4956860c9eadc85f37
Signed-off-by: Mikolai GÃ¼tschow <mikolai.guetschow@tu-dresden.de>
---
 .../arm/drivers/cc3xx/low_level_driver/src/cc3xx_init.c      | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/platform/ext/target/arm/drivers/cc3xx/low_level_driver/src/cc3xx_init.c b/platform/ext/target/arm/drivers/cc3xx/low_level_driver/src/cc3xx_init.c
index 90b08d5d..308cb5c2 100644
--- a/platform/ext/target/arm/drivers/cc3xx/low_level_driver/src/cc3xx_init.c
+++ b/platform/ext/target/arm/drivers/cc3xx/low_level_driver/src/cc3xx_init.c
@@ -65,6 +65,11 @@ static void check_features(void)
 
 static cc3xx_err_t setup_dfa_countermeasures(void)
 {
+#ifdef CC3XX_CONFIG_HW_VERSION_CC310
+    /* CC310 has no AO interface where DFA could be disabled */
+    return CC3XX_ERR_SUCCESS;
+#endif /* CC3XX_CONFIG_HW_VERSION_CC310 */
+
 #ifdef CC3XX_CONFIG_DFA_MITIGATIONS_ENABLE
     const uint32_t dfa_is_supported = P_CC3XX->aes.aes_hw_flags & (0x1 << 12);
     uint32_t lock_dfa_enabled = dfa_is_supported;
-- 
2.39.5

